<!doctype html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<title>Frontend backend connector</title>
	<link rel="stylesheet" href="jquery-ui-1.12.1.custom\jquery-ui.css"/>
	<script src="jquery-ui-1.12.1.custom\	external\jquery\jquery.js"></script>
	<script src="jquery-ui-1.12.1.custom\jquery-ui.js"></script>
	<script>
	;(function() {
		"use strict";
			$( document ).ready( function() {
				var projectsArr=[];
				var currentProject=-1;  //id
				var currentProjectObject;
				var currentDialog;
				var newProjectForm;
				var currentConnection;

//---------------------CLASS PROJECT----------------------
				var Project=function (name,description){
					this.name=name;
					this.description=description;
					this.connections=[];
					this.connections[0]={};
					this.connections[0].connectionName="Connection 1";
					this.connections[0].connectionURL="http://yourserverpath";
					this.connections[0].request={parameter1:"dataParameter1",parameter2:"dataParameter2"}

					//add call
				}

//jQuery UI
				//$( '#projectName' ).css( 'color', 'red' );
				//console.log("project name2: ", $("#projectName").val(''));
				$('input').addClass("ui-widget ui-widget-content ui-corner-all");
				$('textarea').addClass("ui-widget  ui-corner-all");
				$('label').addClass("ui-widget ");


//------------------CHOOSE PROJECT-----------------------------------
var updateProjectList = function (){
		console.log("update project list run");
		$.ajax({
			url:'http://localhost:26893/projectsND',
			method:'get',
			//answer data from server:
			dataType: 'json',
			success:function( data ){
					console.log("update project list ajax back", data);
					//console.log(data.projects);
					$('#chooseProject option').remove();
					for (var i=0;i<data.projects.length;i++){

						//console.log(data.projects[i].name);

						$('<option>')
						.html(data.projects[i].name)
						.attr("value",data.projects[i].id)
						.attr("title",data.projects[i].description)
						.appendTo('#chooseProject');
					}

					$('#chooseProject').selectmenu({
						change: function( event, data ) {
							//console.log("combobox value project id: ", data.item.value);
							currentProject=data.item.value;
							console.log( "current project changed to :", currentProject );
							//receive currentProjectObject
							$.ajax({
								url:'http://localhost:26893/projectsND/'+currentProject,
								method:'get',
								//answer data from server:
								dataType: 'json',
								//sending data
								success:function( data ){

									currentProjectObject=JSON.parse(JSON.stringify(data));
									console.log("current project object: ", currentProjectObject );
									showProjectDetail();
									//return data;
								}
							}); //ajax
						}  //change
					});  //$('#chooseProject').selectmenu({
					$('#chooseProject').selectmenu( "refresh" );
					console.log("choose project refreshed");
					$('#chooseProject').selectmenu( "menuWidget" )
					.addClass( "overflow" ); //select menu

			} //success
		}); //ajax

		//update project list from server:


} //update project list

updateProjectList();
console.log("main program läuft");

//--------------------choose connection-----------------------------

var showProjectDetail = function (){
		console.log("show project detail läuft");
		$('#chooseConnection option').remove();
		console.log("currentProjectObject", currentProjectObject);
		for (var i=0;i<currentProjectObject.connections.length;i++){

			//console.log(data.projects[i].name);

			$('<option>')
			.html(currentProjectObject.connections[i].connectionName)
			.attr("value",i)
			.attr("title",currentProjectObject.connections[i].connectionDetail)
			.appendTo('#chooseConnection');
		} //for



		$('#chooseConnection').selectmenu({
      change: function( event, data ) {
				currentConnection=data.item.value;
      }
		}).selectmenu( "menuWidget" )
    .addClass( "overflow" ); //select menu

		$('#chooseConnection').selectmenu( "refresh" );
		console.log("choose connection refreshed");
		$('#chooseConnection').selectmenu( "menuWidget" )
		.addClass( "overflow" ); //select menu
} //show project detail

//showProjectDetail();


//-------------------NEW PROJECT DIALOG-------------------------------
newProjectForm=		$( "#newProjectForm" ).dialog({

						autoOpen: false,
						resizable: false,
						modal: true,
						title: "Add new project",
			      show: {
							create: function( event, ui ) {},
			        effect: "blind",
			        duration: 1000
			      },
			      hide: {
			        effect: "size",
			        duration: 1000
			      },
						buttons: {
			        "Create project": function() {

								currentDialog="#newProjectForm";
								$( '#saveConfirm').dialog("open");
			          //$( this ).dialog( "close" );
								//create code!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
			        },
			        Cancel: function() {
								currentDialog="#newProjectForm";
								$( '#cancelConfirm').dialog("open");

					    }
			      }, //end of buttons

				}); //end new project dialog
//-------------------CANCEL CONFIRM DIALOG-------------------------------
	$( "#cancelConfirm" ).dialog({
			      autoOpen: false,
						resizable: false,
						modal: true,
						title: "Cancel confirmation",
			      show: {
			        effect: "blind",
			        duration: 1000
			      },
			      hide: {
			        effect: "size",
			        duration: 1000
			      },
						buttons: {
			        "Yes": function() {
								$(currentDialog).dialog("close" );
			          $( this ).dialog( "close" );
								//create code cancel without saving!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
			        },
			        "No": function() {
								$( this ).dialog( "close" );
					    }
			      } //end of buttons
				}); //end new project dialog

//-----------------------save confirm--------------------------------------------------
				$( "#saveConfirm" ).dialog({
			      autoOpen: false,
						resizable: false,
						modal: true,
						title: "Confirm saving",
			      show: {
			        effect: "blind",
			        duration: 1000
			      },
			      hide: {
			        effect: "size",
			        duration: 1000
			      },
						buttons: {
			        "Yes": function() {
								switch (currentDialog) {
									case "#newProjectForm":
										var newProjectObject = new Project($('#projectName').val(),$('#projectDetail').val());
											$.ajax({
											url:'http://localhost:26893/projectsND',
											method:'post',
											//answer data from server:
											dataType: 'json',
											//sending data
											data:{dataObject:JSON.stringify(newProjectObject)},
											/*data:JSON.stringify(jsonRoot),*/
											success:function( data ){
												console.log("saveNewproject");
												console.log(data);
												//return data;

											}
										}); //ajax


										case "#saveProjectBtn":
											$.ajax({
												url:'http://localhost:26893/projectsND/'+currentProject,
												method:'put',
												//answer data from server:
												dataType:'json',
												//sending data
												data:{dataObject:JSON.stringify(currentProjectObject
												)},
												/*data:JSON.stringify(jsonRoot),*/
												success:function( data ){

													console.log("Saved project data: ",data);
													//return data;
												}
											}); //ajax



								} //switch end of
								$(currentDialog).dialog("close" );
			          $( this ).dialog( "close" );
								updateProjectList();

			        },
			        "No": function() {
								$( this ).dialog( "close" );
					    }
			      } //end of buttons
				}); //end new project dialog
//----------------------------delete confirmation---------------------------------

$( "#deleteConfirm" ).dialog({
		autoOpen: false,
		resizable: false,
		modal: true,
		title: "Confirm deleting",
		show: {
			effect: "blind",
			duration: 1000
		},
		hide: {
			effect: "size",
			duration: 1000
		},
		buttons: {
			"Yes": function() {
				console.log("after clicked yes");
				console.log("current dialog: " + currentDialog);
				switch (currentDialog) {
					case "#deleteProjectBtn":

							$.ajax({
							url:'http://localhost:26893/projectsND/'+currentProject,
							method:'delete',
							//answer data from server:
							dataType: 'json',
							//sending data
							//data:{dataObject:JSON.stringify(newProjectObject)},
							/*data:JSON.stringify(jsonRoot),*/
							success:function( data ){
								//$('#chooseProject').selectmenu(' refresh ');
								updateProjectList();
								console.log("dataDeleted message:");
								console.log(data);
								//return data;
							}
						}); //ajax

				} //switch end of
				//$(currentDialog).dialog("close" );
				$( this ).dialog( "close" );
				updateProjectList();
				//create code cancel without saving!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
			},
			"No": function() {
				$( this ).dialog( "close" );
			}
		} //end of buttons
}); //end new project dialog


//xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx   end delete confirm   xxxxxxxxxxxxxxxxxxxxxxxxxxxx

			$(document).tooltip({
					show: {
	        effect: "slideDown",
	        delay: 250
	      }
	    });

			$("#connectionAccordion").accordion({
				heightStyle: "content"
			});
			//$("#addProject").button();

//------------------open newProjectForm----------------------------------------

			 //currentProject=new Project(6,"project7","Das projekt macht nichts, aber um so mehr ordentlich");

			$('#addProjectBtn').button().on('click', function(){
				$("#projectName").val('');
				$("#projectDetail").val('');
				$( "#newProjectForm" ).dialog( "open" );
			}); //add project button

			$('#deleteProjectBtn').button().on('click', function(){
				console.log("current project: ",currentProject);
				currentDialog="#deleteProjectBtn";
				$( "#deleteConfirm" ).dialog( "open" );
				console.log("delete button clicked");
			});

			$('#saveProjectBtn').button().on('click', function(){
				currentDialog="#saveProjectBtn";
				$( "#saveConfirm" ).dialog( "open" );
			}); //add project button
		}) //document ready
	}()); //outer-function
	</script>
	<style>
	body > div:first-of-type {
		padding:0;
		text-align: center;
	}

	.wrapMainBlock, .wrapActiveProject {
		margin: 5%;
		border-radius: 10px;
		padding: 10px;
		background: #F1F1F1;
		border: 1px solid #F6F1E6;
	}
	/*
	#addProjectBtn {
		margin: 20px 10px 0  0;
	}
	*/
	label {
      display: block;
      margin:  0  0 15px 0;
    }
	  .overflow { height: 200px; }

	</style>
</head>
<body>
<div class="wrapMainBlock">
	<h2>API DOC</h2>
</div>



<div class="wrapMainBlock">
	<label for="chooseProject">Select a project: </label>
    <select name="chooseProject" id="chooseProject">
    </select>
	<button id="addProjectBtn">new</button>
	<button id="deleteProjectBtn">delete</button>
	<button id="saveProjectBtn">save</button>
</div>

<div class="wrapMainBlock" id="connectionWrap">
	<label for="chooseConnection">Select connection: </label>
    <select name="chooseConnection" id="chooseConnection">
    </select>
	<button id="addConnectionBtn">new</button>
	<button id="deleteConnectionBtn">delete</button>
	<div id="connectionAccordion">
		<h3>Request</h3>
		<div>
				project template nr. 1
				project template nr. 1
				project template nr. 1
		</div>
		<h3>Response</h3>
		<div>
				project template nr. 2
				project template nr. 2
				project template nr. 2
		</div>

	</div>
</div>

<div class="wrapActiveProject">

</div>

<div id="newProjectForm" title="Create new project">
  <label for="projectName">Name: </label><input type="text" id="projectName" maxlength="18" autocomplete="off" value="">
  <label for="projectDetail">Detail: </label><textarea rows="4" cols="25" id="projectDetail" autocomplete="off" value=""></textarea>
</div>
<div id="cancelConfirm" >
	<p>Close dialog without saving?</p>
</div>
<div id="saveConfirm" >
	<p>Are you sure you want to save?</p>
</div>
<div id="deleteConfirm" >
	<p>Are you sure you want to delete?</p>
</div>
</body>
</html>
